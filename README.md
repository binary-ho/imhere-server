# I'm here! Server
 
# 1. 프로젝트 소개
출결 관리 서비스 I'm here! 입니다 <Br>
수업을 개설하고, 학생의 출결을 관리해요! <br> <br>

지금 바로 출석하러 가기 -> [imhere.im](imhere.im)

<br> <br>
 
## GDSC Hongik 웹 기초 스터디의 출석 문제를 해결했습니다!
동아리 GDSC Hongik에서 웹 기초 스터디 강의를 맡게 된 후, 진행한 참여자 사전 조사에서 140명의 신청자가 있었습니다. <br>
회원이 30명일 때 강의를 기획했기 때문에 처음 수강 인원을 40여명 정도로 예상했으나, 훨씬 많은 학우분들이 신청해주셨습니다.
동아리 내 개설된 다른 스터디 또한 마찬가지였습니다. 

동아리에선 대면 수업시 140명의 출결 방식에 대해 고민하게 되었습니다. 
출결 관리 문제를 직접 해결하고 싶어 동아리의 다양한 스터디에서 쓰일 수 있는 출석 프로그램을 제작했습니다.

<br>

- [<b>기초 웹 스터디 강의 소개 페이지</b>](https://www.gdschongik.com/web-study/introduce) 
- [<b>수업과 실습 영상 유튜브</b>](https://www.youtube.com/watch?v=KpxVNBJ9UDw)

<br>

### 시간과 에너지의 절약했습니다
개발 일정이 늦어지면서, 70명의 대면 수업 참석 인원을 직접 호명하여 출석 체크를 진행한 수업이 있었습니다.

한분 한분 이름을 부르며 얼굴을 확인하니 총 10분의 시간과 많은 에너지가 소모되었습니다. 
시간도 문제이지만, 수업을 시작하기 전 부터 지친 상태로 수업을 시작하게 되었습니다. 

Imhere 도입 이후 출석 번호를 칠판에 적은 뒤, 수업을 바로 진행할 수 있었습니다. 
겨우 1분의 시간이 소모 되었고, 수업에 바로 집중할 수 있었습니다.

출석 위치와 학교의 거리를 계산하므로, 출석 위치가 너무 먼 학생들의 실제 참석 여부를 확인했고, 부정 출석 인원을 미출석 처리할 수 있었습니다.

<br>

# 2. 서비스 기능 소개

<details>
<summary> <h2> 강사 계정 기능 </h2> </summary>

## 강사 계정 기능

### 1. 강의 관리
강의를 개설하고 폐쇄할 수 있습니다.

### 2. 출결 관리
수업을 Open하면 출석 번호가 발급되고, 학생은 10분간 출석 번호를 입력해 출석할 수 있습니다.

출석시 출석 위치와 강의실 사이의 거리가 측정되어 부정 출석을 확인할 수 있습니다.

특정 날짜의 출석 정보를 엑셀 파일로 다운받을 수 있습니다.

### 3. 수강생 관리
수강 신청 학생을 승인하거나 거절할 수 있어요!

</details>

<details>
<summary> <h2> 학생 계정 기능 </h2> </summary>
  
## 학생 계정 기능

### 1. 회원가입
구글 이메일 인증을 통해 회원가입 할 수 있습니다.

### 2. 수강 신청
원하는 수업에 수강신청 할 수 있습니다.

### 3. 출석 신청
수강 승인 받은 수업이, Open된 경우 출석 번호와 함께 출석 신청할 수 있습니다. 

</details>

# 3. 인프라 구조와 설명

![image](https://github.com/binary-ho/imhere-server/assets/71186266/f781a563-45a1-4e10-81ab-9e0ad5079e86)


프론트엔드 프로젝트와 백엔드 프로젝트를 직접 구현하고, 배포했습니다.
백엔드와 인프라 작업에 집중하기 위해, v1 배포 이후의 클라이언트 프로젝트는 @eugene028 님께서 맡아주시고 있습니다. 


## 3.1 클라이언트와 배포
프론트엔드는 javascript 라이브러리 react를 이용해 만들었습니다. 
- 보안을 위해 정적 리소스를 저장하는 버킷 S3의 웹 호스팅을 사용하지 않고, CloudFront를 통해 호스팅 했습니다. <br> CloudFront를 이용함으로써 안전하게 원본을 지키고, 한국 리전에 캐싱할 수 있었습니다.
- 백엔드와 인프라 작업에 집중하기 위해, v1 배포 이후의 클라이언트 프로젝트는 @eugene028 님께서 맡아주시고 있습니다. <br> 타입스크립트로의 마이그레이션과 디자인 개선 및 기능 고도화를 진행해주셨습니다. <br> 클라이언트 배포를 위해 AWS IAM S3, CloudFront FullAccess 권한을 부여했습니다.
- 클라이언트 작업자의 편의와 배포 전 테스트를 위해 dev 서버와 prod 서버를 구분해 사용중입니다. <br>  클라이언트 개발자는 dev 서버로 요청을 보내며 개발중입니다
- [imhere-client 바로가기](https://github.com/eugene028/imhere-client)

## 3.2 백엔드
백엔드 애플리케이션은 유연한 프로그램을 위해, java 기반의 Spring Boot 프레임워크를 이용해 만들었습니다. <br>

- 출석시 극히 짧은 시간에 많은 요청이 몰리게 될 것을 걱정하여, 강의 출석시 출석 번호를 확인하는 과정에 redis를 활용했습니다. 강의 id와 출결 번호가 key-value로 저장되고, 출석 요청은 레디스에 저장된 값을 확인합니다. 일치하는 경우 DB에 해당 학생이 출석했음을 저장합니다. <br> 학생의 매 출석 요청시마다 발생할 DB Read를 줄일 수 있었습니다.
- 회원의 권한에 따라 사용할 수 있는 기능을 분리하고, 서버의 메모리를 아끼면서도 회원이 편하게 이용할 수 있도록 스프링 시큐리티와 토큰을 이용해 인증-인가 기능을 구현했습니다. 시큐리티 컨텍스트 테스트를 위해 WithSecurityContext를 활용했습니다. 
- 문제 상황을 추적하기 위해 로깅을 하였습니다. 성능을 고려해 일반 출력문이나, 스프링 부트 기본 제공 logback을 사용하지 않고, log4j2를 사용했습니다. 로그는 날짜를 기준으로 파일로 저장되며, 지정 용량을 벗어나는 경우 같은 날짜에도 다른 파일에 보관됩니다.
- 유연한 설계와 회귀 방지를 위한 테스트의 작성을 위해 의존성 역전을 적극적으로 활용했습니다. <br> RedisTemplate과 JavaMailSender를 사용하거나, 토큰 생성을 위해 SECRET을 사용하는 객체들을 추상화하여, 빈으로 관리하고, 호출부에선 추상화된 인터페이스를 의존하도록 구현했습니다. <br> 테스트시엔 추상화된 인터페이스를 구현한 Fake 객체를 활용했습니다. 

<br>

## 3.3 앱과 DB 서버 배포

어플리케이션은 도커 이미지로 만들어 레디스 이미지와 함께 AWS EC2 서비스에 배포했습니다. <br>
유저의 안전한 접속을 위해 certibot을 이용해 Let's Encrypt의 인증서를 발급 받아 HTTPS 프로토콜 연결을 구축했습니다. 
이를 위한 리버스 프록시엔 nginx 서버를 사용했고, nginx는 인증서 경로가 포함된 이미지를 만들어 배포했습니다. <br> 

모든 컨테이너는 도커 컴포즈로 간편하게 관리중입니다. <br>

MySQL는 원활한 배포와 관리 및 백업을 위해 RDS 서비스를 이용했습니다.

# 4. 프로젝트 관련 블로그 글
1. [@WithSecurityContext를 이용해 커스텀 UserDetails SecurityContext Test 코드 작성하기](https://dwaejinho.tistory.com/entry/%EC%BB%A4%EC%8A%A4%ED%85%80-UserDetails-SecurityContext-Test-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0)
2. S3와 CloudFront를 활용한 배포와 보안 설정 -> [S3 배포시 '이것' 설정 안 하자... 개인정보 '술술'](https://dwaejinho.tistory.com/entry/%EC%B6%A9%EA%B2%A9-S3-Hosting-%EC%9D%B4%EA%B2%83-%EC%84%A4%EC%A0%95-%EC%95%88-%ED%95%98%EC%9E%90-%EA%B0%9C%EC%9D%B8%EC%A0%95%EB%B3%B4-%EC%88%A0%EC%88%A0)
3. Nginx 다중 소스 허용과 if 문법 -> [Don't try this at home - "IF" is Evil](https://dwaejinho.tistory.com/entry/Nginx-%EC%95%85%EB%A7%88%EC%9D%98-IF-Dont-try-if-at-home)
4. CORS 처리와 HTTPS 인증 처리 -> 작성 예정
2. @Slf4j와 logback, log4j, log4j2 -> 작성 예정
3. 도커 컴포즈를 활용한 백엔드 애플리케이션 배포하기 -> 작성 예정
4. 의존성 역전으로 테스트하기 어려운 객체 테스트하기 -> 작성 예정


# 5. 향후 개발 계획
GDSC Hongik 외에도 다른 커뮤니티에서도 사용할 수 있도록
TPS 1000건을 목표로 고도화 할 예정입니다.

학생들끼리 서로의 과제물을 확인할 수 있는 커뮤니티 기능에 대한 학생들의 익명 요청이 많아 추가할 예정입니다.   

1. 스터디 과제물 커뮤티니
2. 깃허브 회원가입과 로그인
3. 쓰로틀링
4. 스터디별 강의실 위치 지정
5. 더 자세한 로깅
6. 메서드별 접근 권한 확인을 AOP로 처리
7. 회원 비밀번호 찾기
8. 회원 탈퇴
